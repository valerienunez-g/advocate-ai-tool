<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Assistant for Advocates</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Song+Myung&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        h1, .prose h3 {
            font-family: 'Song Myung', serif;
        }
        .prose {
            max-width: 100%;
        }
        .prose h3 {
            margin-bottom: 0.5rem;
        }
        .prose p {
            margin-top: 0.25rem;
            margin-bottom: 1rem;
        }
        .prose pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .copy-feedback {
            position: absolute;
            top: 0.5rem;
            right: 3.5rem;
            background-color: #22c55e; /* green-500 */
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-4xl mx-auto p-4 md:p-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Advocate AI Prompt Assistant</h1>
                <p class="text-gray-600 mt-2">Paste the customer's message below to get the best AI prompt recipe. Please ensure no PII or PHI is in your submission.</p>
            </header>

            <main>
                <div class="mb-6">
                    <label for="customer-question" class="block text-sm font-medium text-gray-700 mb-2">Customer's Message</label>
                    <textarea id="customer-question" rows="6" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A8080] focus:border-[#0A8080] transition-shadow" placeholder="e.g., 'Why was I charged twice this month? My bill is higher than usual and I don't understand the new fee...'"></textarea>
                </div>

                <div class="text-center">
                    <button id="get-prompt-btn" class="bg-[#0A8080] text-white font-semibold py-3 px-8 rounded-lg hover:bg-[#086666] focus:outline-none focus:ring-4 focus:ring-[#68c7c7] transition-transform transform hover:scale-105">
                        Find the Right Prompt
                    </button>
                </div>

                <div id="results-container" class="mt-10 prose">
                    <!-- Loading indicator will be shown here -->
                    <div id="loading" class="text-center hidden">
                        <svg class="animate-spin h-8 w-8 text-[#0A8080] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-gray-600">Analyzing the message and finding the best recipe...</p>
                    </div>
                     <!-- Error message will be shown here -->
                    <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                        <strong class="font-bold">Oops!</strong>
                        <span class="block sm:inline">Something went wrong. Please try again.</span>
                    </div>
                    <!-- AI response will be injected here -->
                    <div id="prompt-recommendations"></div>
                </div>
            </main>
        </div>
        <footer class="text-center mt-6">
             <div class="w-full max-w-md mx-auto">
                <label for="api-key-input" class="block text-sm font-medium text-gray-700">Gemini API Key</label>
                <div class="mt-1 flex rounded-md shadow-sm">
                    <input type="password" id="api-key-input" class="flex-1 block w-full rounded-none rounded-l-md sm:text-sm border-gray-300 p-2" placeholder="Enter your API key here">
                    <button id="save-key-btn" class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">Save</button>
                </div>
                 <p class="mt-2 text-xs text-gray-500">
                    Your key is saved in your browser. <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-[#0A8080] hover:underline">Get your Gemini API Key here.</a>
                </p>
            </div>
            <p class="text-sm text-gray-500 mt-4">Powered by the Gemini API</p>
        </footer>
    </div>

    <script>
        const getPromptBtn = document.getElementById('get-prompt-btn');
        const customerQuestionEl = document.getElementById('customer-question');
        const resultsContainer = document.getElementById('results-container');
        const loadingEl = document.getElementById('loading');
        const errorMessageEl = document.getElementById('error-message');
        const recommendationsEl = document.getElementById('prompt-recommendations');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveKeyBtn = document.getElementById('save-key-btn');

        // Load saved API key from localStorage
        const loadApiKey = () => {
            const savedKey = localStorage.getItem('geminiApiKey');
            if (savedKey) {
                apiKeyInput.value = savedKey;
            }
        };
        
        // Save API key to localStorage
        saveKeyBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('geminiApiKey', key);
                alert('API Key saved!');
            } else {
                alert('Please enter a valid API key.');
            }
        });

        // This is the playbook content from the user's document.
        const playbookContent = `
            Section 1: Understanding & Diagnosing the Issue
            Goal: To use AI to quickly grasp the full context of a customer's problem before responding.
            
            Recipe: Summarize a Long Conversation
            - When to Use: When a ticket has a long email chain or chat transcript that you are taking over.
            - Goal: To get a quick, unbiased summary of the issue, what's been tried, and the customer's current emotional state.
            - Ready-to-Use Prompt:
              Persona: Act as a senior support specialist reviewing a case file.
              Context: [Paste the entire email chain or chat history here.]
              Task: Analyze the conversation above and provide a brief, neutral summary. I need to understand: What is the customer's primary, unresolved problem? What solutions or troubleshooting steps have already been attempted? What is the customer's current sentiment (e.g., frustrated, confused, calm)?
              Constraints: Keep the summary under 150 words. Use a bulleted list for clarity.

            Recipe: Extract Key Information from a Vague Message
            - When to Use: When a customer sends a long, rambling, or unclear message.
            - Goal: To distill the core issue and identify specific, actionable details needed for troubleshooting.
            - Ready-to-Use Prompt:
              Persona: Act as a detail-oriented technical analyst.
              Context: A customer has sent the following message: [Paste customer's message here.]
              Task: Read the message and extract the essential information. Identify the core problem the customer is facing. List any specific error messages, product names, or account details mentioned. Create a list of clarifying questions to ask the customer to get the information we need to solve this.
              Constraints: Format the output as three distinct sections: "Core Problem," "Key Details," and "Clarifying Questions."

            Section 2: Crafting a Clear & Empathetic Response
            Goal: To use AI to draft responses that are accurate, clear, and emotionally intelligent.

            Recipe: Simplify Technical Language
            - When to Use: When you need to explain a complex technical concept to a non-technical customer.
            - Goal: To translate jargon into a simple, easy-to-understand analogy or explanation.
            - Ready-to-Use Prompt:
              Persona: Act as a friendly technology educator who is great at making complex topics simple.
              Context: I need to explain the concept of [insert technical concept, e.g., "clearing browser cache," "IP address," "two-factor authentication"] to a customer who is not tech-savvy.
              Task: Write a simple, one-paragraph explanation of this concept. Use a relatable analogy to make it easier to understand.
              Constraints: Avoid all technical jargon. Keep the explanation under 100 words.

            Recipe: Adopt a Specific Tone
            - When to Use: When dealing with a customer who is clearly angry, frustrated, or anxious and you need to match their emotional state with the appropriate tone.
            - Goal: To generate a response that de-escalates tension and shows empathy.
            - Ready-to-Use Prompt:
              Persona: Act as an expert in empathetic communication and customer service de-escalation. Your tone should be [choose one: calm, reassuring, apologetic, confident].
              Context: A customer is very [e.g., angry, worried] about [summarize the issue].
              Task: Rewrite the following draft response to have a more [chosen tone] and empathetic tone. My draft is: "[Paste your draft response here.]"
              Constraints: Focus only on improving the tone; do not change the core factual information.

            Section 3: Common Customer Scenarios
            Goal: To provide ready-to-use prompts for the most frequent customer issues.

            Recipe: Explain a Billing Charge
            - When to Use: A customer is questioning a specific charge or the total amount of their bill.
            - Goal: To clearly explain the charge, reassure the customer, and build trust.
            - Ready-to-Use Prompt:
              Persona: Act as a helpful and patient billing specialist named Alex. Your tone should be reassuring and professional.
              Context: A customer is confused and concerned about a charge on their bill. [Paste customer's question and relevant billing line items here.]
              Task: Draft a clear, empathetic email reply to the customer. Use the A.V.A. method to first acknowledge their confusion. Then, identify the specific charge and explain what it is for in simple terms.
              Constraints: Keep the explanation concise (under 150 words). Do not offer a discount or refund unless it's a clear error. End by asking if the explanation is clear.

            Recipe: Handle a Service Outage
            - When to Use: A customer is reporting, or is impacted by, a known service outage.
            - Goal: To provide a sincere apology, offer reassurance, and set clear expectations for follow-up.
            - Ready-to-Use Prompt:
              Persona: Act as a calm, professional, and highly empathetic support specialist.
              Context: The customer is impacted by our current service outage. They are [mention their sentiment, e.g., "frustrated," "concerned"].
              Task: Draft a concise and sincere apology. Validate their frustration and confirm that we are aware of a major outage. State that our team's top priority is fixing it. Do not make excuses. State that you will personally provide them with an update as soon as you have one.
              Constraints: Keep the message under 100 words. Do not promise a specific time-to-fix.
        `;
        
        // --- Main function to get recommendations from the API ---
        const getRecommendations = async (customerQuestion, apiKey) => {
            loadingEl.classList.remove('hidden');
            recommendationsEl.innerHTML = '';
            errorMessageEl.classList.add('hidden');

            const systemPrompt = `
                Act as an AI Support Coach and an expert on the "Tier 1 Advocate: AI Interaction Recipes & Best Practices" playbook. Your sole purpose is to help a Tier 1 Advocate select the best prompt for a given customer situation.
                You will be given the full content of the playbook and a customer's message. Your task is to analyze the customer's message and recommend the top 1-2 most relevant Interaction Recipes.
                For EACH recommendation, you MUST format your response EXACTLY as follows, using Markdown:
                ### Recipe: [Exact Recipe Name]
                **Why it's a good choice:** [Briefly explain why this recipe is a good fit for the customer's message.]
                **Ready-to-Use Prompt:**
                \`\`\`
                [Paste the complete, ready-to-use prompt from the playbook here. Replace bracketed placeholders like '[Paste customer's message here]' with the actual customer message provided.]
                \`\`\`
                Constraints:
                - Only recommend recipes found in the provided playbook.
                - Format the output precisely as specified above.
                - If no recipe fits well, state that and explain why.
            `;

            const userQuery = `
                Here is the playbook:
                ${playbookContent}
                ---
                Here is the customer's message:
                "${customerQuestion}"
            `;
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                 const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || `API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const rawText = candidate.content.parts[0].text;
                    let htmlContent = rawText
                        .replace(/### (.*)/g, '<h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">$1</h3>')
                        .replace(/\*\*(.*?)\*\*:/g, '<p class="font-semibold text-gray-700 mt-2 mb-1">$1:</p>')
                        .replace(/```([\s\S]*?)```/g, (match, p1) => {
                            const uniqueId = `prompt-${Math.random().toString(36).substr(2, 9)}`;
                            const feedbackId = `feedback-${uniqueId}`;
                            const promptText = p1.trim().replace(/`/g, '\\`'); // Escape backticks for textarea
                            return `
                                <div class="relative bg-gray-800 text-white p-4 rounded-lg mt-2">
                                    <pre class="text-sm font-mono">${p1.trim()}</pre>
                                    <div id="${feedbackId}" class="copy-feedback">Copied!</div>
                                    <button onclick="copyToClipboard('${uniqueId}', '${feedbackId}')" class="absolute top-2 right-2 bg-gray-600 hover:bg-gray-500 text-white font-semibold py-1 px-2 text-xs rounded-md transition-colors">Copy</button>
                                    <textarea id="${uniqueId}" style="position: absolute; left: -9999px;">${promptText}</textarea>
                                </div>`;
                        })
                        .replace(/\n\n/g, '<p>')
                        .replace(/\n/g, '<br>');


                    recommendationsEl.innerHTML = htmlContent;

                } else {
                    throw new Error("No content found in the API response.");
                }

            } catch (error) {
                console.error("Error fetching recommendations:", error);
                errorMessageEl.classList.remove('hidden');
                errorMessageEl.querySelector('span').textContent = ` ${error.message || 'An unknown error occurred.'}`;
            } finally {
                loadingEl.classList.add('hidden');
            }
        };
        
        // --- Function to handle copying text to clipboard ---
        window.copyToClipboard = (elementId, feedbackId) => {
            const textarea = document.getElementById(elementId);
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                const feedbackEl = document.getElementById(feedbackId);
                feedbackEl.style.display = 'block';
                setTimeout(() => { feedbackEl.style.opacity = '1'; }, 10); // Fade in
                setTimeout(() => { 
                    feedbackEl.style.opacity = '0';
                    setTimeout(() => { feedbackEl.style.display = 'none'; }, 300);
                }, 2000); // Fade out after 2 seconds
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        }
        
        // --- Event listener for the main button ---
        getPromptBtn.addEventListener('click', () => {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                alert('Please save your Gemini API key first.');
                return;
            }
            
            const customerQuestion = customerQuestionEl.value.trim();
            
            if (customerQuestion) {
                getRecommendations(customerQuestion, apiKey);
            } else {
                errorMessageEl.classList.remove('hidden');
                errorMessageEl.querySelector('span').textContent = ' Please enter a customer message first.';
            }
        });

        // Load the key when the page loads
        loadApiKey();

    </script>
</body>
</html>

