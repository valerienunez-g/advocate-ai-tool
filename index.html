<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Assistant for Advocates</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Song+Myung&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        h1, .prose h3 {
            font-family: 'Song Myung', serif;
        }
        .prose {
            max-width: 100%;
        }
        .prose h3 {
            margin-bottom: 0.5rem;
        }
        .prose p {
            margin-top: 0.25rem;
            margin-bottom: 1rem;
        }
        .prose pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .copy-feedback {
            position: absolute;
            top: 0.5rem;
            right: 3.5rem;
            background-color: #22c55e; /* green-500 */
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-4xl mx-auto p-4 md:p-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Advocate AI Prompt Assistant</h1>
                <p class="text-gray-600 mt-2">Paste the customer's message below to get the best AI prompt recipe. Please ensure that there is no PII or PHI in the submission.</p>
            </header>

            <main>
                <div class="mb-6">
                    <label for="customer-question" class="block text-sm font-medium text-gray-700 mb-2">Customer's Message</label>
                    <textarea id="customer-question" rows="6" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A8080] focus:border-[#0A8080] transition-shadow" placeholder="e.g., 'Why was I charged twice this month? My bill is higher than usual and I don't understand the new fee...'"></textarea>
                </div>

                <div class="text-center">
                    <button id="get-prompt-btn" class="bg-[#0A8080] text-white font-semibold py-3 px-8 rounded-lg hover:bg-[#086666] focus:outline-none focus:ring-4 focus:ring-[#68c7c7] transition-transform transform hover:scale-105">
                        Find the Right Prompt
                    </button>
                </div>

                <div id="results-container" class="mt-10 prose">
                    <!-- Loading indicator will be shown here -->
                    <div id="loading" class="text-center hidden">
                        <svg class="animate-spin h-8 w-8 text-[#0A8080] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 A0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-gray-600">Analyzing the message and finding the best recipe...</p>
                    </div>
                     <!-- Error message will be shown here -->
                    <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                        <strong class="font-bold">Oops!</strong>
                        <span class="block sm:inline">Something went wrong. Please try again.</span>
                    </div>
                    <!-- AI response will be injected here -->
                    <div id="prompt-recommendations"></div>
                </div>
            </main>
        </div>
        <footer class="text-center mt-6">
            <p class="text-sm text-gray-500">Powered by the Gemini API</p>
        </footer>
    </div>

    <script>
        const getPromptBtn = document.getElementById('get-prompt-btn');
        const customerQuestionEl = document.getElementById('customer-question');
        const resultsContainer = document.getElementById('results-container');
        const loadingEl = document.getElementById('loading');
        const errorMessageEl = document.getElementById('error-message');
        const recommendationsEl = document.getElementById('prompt-recommendations');

        // This is the playbook content from the user's document.
        const playbookContent = `
Core Principles for AI Interaction
Advocate Mission
To resolve Tier 1 in-scope issues quickly and clearly, guide customers to self-serve where possible, and transfer out-of-scope cases cleanly with strong context to reduce customer effort.
Advocate Style
Calm, concise, friendly, and transparent; sets expectations and avoids internal jargon with customers.
All AI-generated responses should embody this mission and style.
Section 1: Understanding & Diagnosing the Issue
Goal: To use AI to quickly grasp the full context of a customer's problem before responding.
Recipe: Summarize a Long Conversation
When to Use: When a ticket has a long email chain or chat transcript that you are taking over.
Goal: To get a quick, unbiased summary of the issue, what's been tried, and the customer's current emotional state.
Ready-to-Use Prompt:
Context: [Paste the entire email chain or chat history here.] Task: Analyze the conversation above and provide a brief, neutral summary. I need to understand:
What is the customer's primary, unresolved problem?
What solutions or troubleshooting steps have already been attempted?
What is the customer's current sentiment (e.g., frustrated, confused, calm)? Constraints: Keep the summary under 150 words. Use a bulleted list for clarity.
Recipe: Extract Key Information from a Vague Message
When to Use: When a customer sends a long, rambling message with critical details hidden inside.
Goal: To pull out only the actionable details needed to start working on the ticket.
Ready-to-Use Prompt:
Context: [Paste the customer's full message here.] Task: Review the customer's message and extract the following key information into a simple list. If any information is missing, note that.
Customer Name:
Account ID or Email:
Specific Error Message or Issue Description:
Product or Service Mentioned:
Date the Issue Started: Constraints: Be precise. Do not infer information that is not explicitly stated.
Section 2: Brainstorming & Troubleshooting
Goal: To use AI as a technical partner to explore solutions beyond standard knowledge base articles.
Recipe: Generate a Troubleshooting Checklist
When to Use: A customer reports a common but vague problem like "it's not working" or "the app is slow."
Goal: To generate a logical, step-by-step series of questions to ask the customer to diagnose the issue methodically.
Ready-to-Use Prompt:
Context: A customer is reporting that our [mention specific product, e.g., "Mobile App"] is [mention the vague problem, e.g., "running slow"]. They have not provided any other details. Task: Create a prioritized, step-by-step troubleshooting checklist. Frame it as a series of simple questions I can ask the customer to narrow down the potential cause. Start with the most common and simple fixes first. Constraints: The questions must be easy for a non-technical customer to understand and answer. Limit the list to the top 5 most likely diagnostic questions.
Section 3: Improving Communication
Goal: To refine messaging for clarity, empathy, and tone.
Best Practice: The A.V.A. Method (Acknowledge, Validate, Act)
Acknowledge: Directly mention the customer's issue and emotion. ("I understand you're frustrated with the unexpected charge.")
Validate: Confirm that their feelings are reasonable. ("It's completely valid to be concerned when your bill is higher than expected.")
Act: Clearly state what you are going to do next. ("I'm going to look into the details of this charge for you right now.")
Recipe: Enhance Empathy and Tone
When to Use: You have a factual, direct draft, but you need to soften the tone for a frustrated or sensitive customer.
Goal: To revise a message to make it more empathetic and reassuring without changing the core facts.
Ready-to-Use Prompt:
Context: I need to deliver a difficult message to a frustrated customer. Here is my current draft: [Paste your draft message here.] Task: Please review and rewrite my draft. First, briefly summarize the customer's issue to show you understand. Then, revise the message to make it more empathetic and reassuring using the "Acknowledge, Validate, Act" method. Explain the changes you made and why. Constraints: Do not change the fundamental outcome or promise something we cannot do.
Recipe: Simplify Technical Language
When to Use: You need to explain a technical concept (e.g., API failure, server error) to a non-technical customer.
Goal: To translate internal jargon into a simple, clear, and honest explanation.
Ready-to-Use Prompt:
Context: I need to explain the following technical situation to a customer: [Paste the technical explanation here, e.g., "The user's session token expired, causing a 500-level authentication error on the backend."]
 Task: Rewrite this explanation in simple, everyday language. Avoid all technical jargon. Using a simple analogy is highly encouraged. 
Constraints: The explanation must remain accurate and honest.
Section 4: Responding to Common Scenarios
Recipe: Explain a Confusing Charge
When to Use: A customer questions a specific line item on their invoice.
Goal: To clearly explain the charge, reassure the customer, and build trust.
Ready-to-Use Prompt:
Context: A customer is confused and concerned about a charge on their bill. [Paste customer's question and relevant billing line items here.] 
Task: Draft a clear, empathetic email reply. Start by summarizing the customer's specific concern to show you understand. Then, use the A.V.A. method to explain the charge in simple terms. 
Constraints: Keep the explanation concise (under 150 words). Do not offer a discount or refund unless it's a clear error. End by asking if the explanation is clear.
Recipe: Handle a Service Outage
When to Use: A customer is reporting, or is impacted by, a known service outage.
Goal: To provide a sincere apology, offer reassurance, and set clear expectations for follow-up.
Ready-to-Use Prompt:
Context: The customer is impacted by our current service outage. They are [mention their sentiment, e.g., "frustrated," "concerned"].
Task: Draft a concise and sincere apology. Start by summarizing their situation and validating their frustration (e.g., "I understand you're frustrated by the service outage, especially since it's impacting your business."). Then, confirm we are aware of the issue and that our team's top priority is fixing it. State that you will personally provide them with an update as soon as you have one. 
Constraints: Keep the message under 100 words. Do not promise a specific time-to-fix.
        `;
        
        // --- Main function to get recommendations from the API ---
        const getRecommendations = async (customerQuestion, apiKey) => {
            loadingEl.classList.remove('hidden');
            recommendationsEl.innerHTML = '';
            errorMessageEl.classList.add('hidden');

            const systemPrompt = `
                Act as an AI Support Coach and an expert on the "Tier 1 Advocate: AI Interaction Recipes & Best Practices" playbook. Your sole purpose is to help a Tier 1 Advocate select the best prompt for a given customer situation.
                You will be given the full content of the playbook and a customer's message. Your task is to analyze the customer's message and recommend the top 1-2 most relevant Interaction Recipes.
                For EACH recommendation, you MUST format your response EXACTLY as follows, using Markdown:
                ### Recipe: [Exact Recipe Name]
                <b>Why it's a good choice:</b> [Briefly explain why this recipe is a good fit for the customer's message.]
                <b>Ready-to-Use Prompt:</b>
                \`\`\`
                [Paste the complete, ready-to-use prompt from the playbook here. Replace bracketed placeholders like '[Paste customer's message here]' with the actual customer message provided.]
                \`\`\`
                Constraints:
                - Only recommend recipes found in the provided playbook.
                - Format the output precisely as specified above.
                - If no recipe fits well, state that and explain why.
            `;

            const userQuery = `
                Here is the playbook:
                ${playbookContent}
                ---
                Here is the customer's message:
                "${customerQuestion}"
            `;
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                 const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || `API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const rawText = candidate.content.parts[0].text;
                    let htmlContent = rawText
                        .replace(/### (.*)/g, '<h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">$1</h3>')
                        .replace(/\*\*(.*?)\*\*:/g, '<p class="font-semibold text-gray-700 mt-2 mb-1">$1:</p>')
                        .replace(/```([\s\S]*?)```/g, (match, p1) => {
                            const uniqueId = `prompt-${Math.random().toString(36).substr(2, 9)}`;
                            const feedbackId = `feedback-${uniqueId}`;
                            const promptText = p1.trim().replace(/`/g, '\\`'); // Escape backticks for textarea
                            return `
                                <div class="relative bg-gray-800 text-white p-4 rounded-lg mt-2">
                                    <pre class="text-sm font-mono">${p1.trim()}</pre>
                                    <div id="${feedbackId}" class="copy-feedback">Copied!</div>
                                    <button onclick="copyToClipboard('${uniqueId}', '${feedbackId}')" class="absolute top-2 right-2 bg-gray-600 hover:bg-gray-500 text-white font-semibold py-1 px-2 text-xs rounded-md transition-colors">Copy</button>
                                    <textarea id="${uniqueId}" style="position: absolute; left: -9999px;">${promptText}</textarea>
                                </div>`;
                        })
                        .replace(/\n\n/g, '<p>')
                        .replace(/\n/g, '<br>');


                    recommendationsEl.innerHTML = htmlContent;

                } else {
                    throw new Error("No content found in the API response.");
                }

            } catch (error) {
                console.error("Error fetching recommendations:", error);
                errorMessageEl.classList.remove('hidden');
                errorMessageEl.querySelector('span').textContent = ` ${error.message || 'An unknown error occurred.'}`;
            } finally {
                loadingEl.classList.add('hidden');
            }
        };
        
        // --- Function to handle copying text to clipboard ---
        window.copyToClipboard = (elementId, feedbackId) => {
            const textarea = document.getElementById(elementId);
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                const feedbackEl = document.getElementById(feedbackId);
                feedbackEl.style.display = 'block';
                setTimeout(() => { feedbackEl.style.opacity = '1'; }, 10); // Fade in
                setTimeout(() => { 
                    feedbackEl.style.opacity = '0';
                    setTimeout(() => { feedbackEl.style.display = 'none'; }, 300);
                }, 2000); // Fade out after 2 seconds
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        }
        
        // --- Event listener for the main button ---
        getPromptBtn.addEventListener('click', () => {
            // Your API key is placed directly here.
            const apiKey = "AIzaSyAC2yR0vzb-5AZ2P_n8TQ7DaTkNs2tY9Dw";
            
            const customerQuestion = customerQuestionEl.value.trim();
            
            if (customerQuestion) {
                getRecommendations(customerQuestion, apiKey);
            } else {
                errorMessageEl.classList.remove('hidden');
                errorMessageEl.querySelector('span').textContent = ' Please enter a customer message first.';
            }
        });

    </script>
</body>
</html>

